---
title: "Vue.jsï¼‹WP REST API ãƒãƒ³ã‚ºã‚ªãƒ³ã€Vue.js #3 Advent Calendar 2017ã€‘"
slug: vue-wprestapi-hands-on
description: "Vue.js #3 Advent Calendar 2017 - Qiitaã€12æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€Vue.jsã¨WP REST APIã‚’é€£æºã—ã¦ã€ç°¡å˜ãªè¨˜äº‹è¡¨ç¤ºã€œéå…¬é–‹è¨˜äº‹ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã¾ã§ã®æ‰‹é †ã‚’ã€ã§ãã‚‹ã ã‘ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒãƒ³ã‚ºã‚ªãƒ³å½¢å¼ã§æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚"
author: ""
date: 2017-12-09T02:54:10.000Z
lastmod: 2024-11-30T10:34:15.423Z
draft: false
tags:
  - Vue2
  - WP-REST-API
image: ""
media: ""
---

<Note type="warn">æ³¨æ„<br />ã“ã®è¨˜äº‹ã¯2017å¹´ã«åŸ·ç­†ã—ãŸã‚‚ã®ã§ã™ã€‚<br />
ãƒ‰ãƒ¡ã‚¤ãƒ³å¤‰æ›´ã«ã‚ˆã‚Šã€Advent Calendarã¸ç™»éŒ²ã—ã¦ã„ãŸè¨˜äº‹ãŒãƒªãƒ³ã‚¯åˆ‡ã‚Œã¨ãªã£ãŸãŸã‚ç§»æ¤ã—ã¾ã—ãŸã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„é–¢é€£ã™ã‚‹æƒ…å ±ãŒå¤ããªã£ã¦ã„ã¾ã™ã®ã§ã€è¿½è¨˜ã‚’ã”ç¢ºèªãã ã•ã„ğŸ™</Note>

<Pre embed="twitter">
940282745514627072
</Pre>

---

**2024/11 è¿½è¨˜**

ç¾åœ¨ã‚‚JAMStackç”¨é€”ã§WP-REST-APIã‚’ä½¿ã„ãŸã„ã¨ã„ã†è¦ä»¶ã‚’å—ã‘ã‚‹äº‹ãŒã‚ã‚‹ãŸã‚ã€
ä¸€éƒ¨ã§ã‚‚å‚è€ƒã«ãªã‚Œã°ã¨æ€ã„ç§»æ¤ã—ã¾ã—ãŸã€‚ã‚‚ã—åŸ·ç­†å½“æ™‚ã€è¿½è¨˜ã¨ã‚‚èª¤ã‚ŠãŒã‚ã‚‹å ´åˆãŠæ•™ãˆé ‚ã‘ãŸã‚‰å¹¸ã„ã§ã™ã€‚

- [Vue CLI](https://cli.vuejs.org/#getting-started) ã¯ç¾åœ¨ãƒ¡ãƒ³ãƒ†ãƒŠã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ãªã£ã¦ã„ã¾ã™ã€‚
ç¾åœ¨ã¯ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã¨ã—ã¦ã€[create-vue](https://github.com/vuejs/create-vue) ã§åŒç­‰ã®ã“ã¨ãŒå¯èƒ½ã§ã™
- create-vueã¯ã€Vite ç’°å¢ƒã«ãªã‚Šã¾ã™ã€‚è¨˜äº‹ä¸­ã®Webpackã¾ã‚ã‚Šã®è¨­å®šã¯ã€ESBuildã¨rollupã®è¨­å®šã«ç½®æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- åŒæ§˜ã«ã€Vueã‚‚2.xç³»ï¼ˆOptions APIï¼‰ã‚’ä¾‹ã¨ã—ã¦ã„ã¾ã™ã€‚ç¾åœ¨ã¯ 3ç³»ï¼ˆComposition APIï¼‰ãŒä¸€èˆ¬çš„ãªå®Ÿè£…ä¾‹ã¨ãªã‚Šã¾ã™
- è¨˜äº‹ä¸­ã€èªè¨¼ã®éƒ¨åˆ†ã§nonceã®é€£æºã®ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’themeã«è¨­ç½®ã—ã¦ã„ã¾ã™ãŒã€å®Ÿãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«ãŠã„ã¦ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’CDNã‹ã‚‰é…ä¿¡ã™ã‚‹ç”¨é€”ãªã©ãŒå¤šã„ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ã”ç†è§£ãã ã•ã„
- exampleã§ã¯ã‚ã‚Šã¤ã¤ãƒ•ãƒƒã‚¿ãƒ¼ã«jsã‚’æŒ‡å®šã™ã‚‹ãªã©ç²—ã„éƒ¨åˆ†ãŒç›®ç«‹ã¡ã¾ã™ãŒã”å®¹èµ¦ãã ã•ã„

---

ã“ã¡ã‚‰ã¯ã€[Vue.js #3 Advent Calendar 2017 - Qiita](https://qiita.com/advent-calendar/2017/vue3)ã€12æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€Vue.jsã¨WP REST APIã‚’é€£æºã—ã¦ã€ç°¡å˜ãªè¨˜äº‹è¡¨ç¤ºã€œéå…¬é–‹è¨˜äº‹ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã¾ã§ã®æ‰‹é †ã‚’ã€ã§ãã‚‹ã ã‘ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒãƒ³ã‚ºã‚ªãƒ³å½¢å¼ã§æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

## è¨˜äº‹ä¸­ã§ä½¿ã†ãƒ„ãƒ¼ãƒ«
 * npm
 * vue-cli
 * Dockerã€docker-compose

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
vue-cliã§ã‚µã‚¯ãƒƒã¨ä½œã‚Šã¾ã™ã€‚
ä»Šå›ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯vue-wp-projectã¨ã—ã¾ã™ã€‚


```shell-session
$ vue init webpack vue-wp-project
```

Vue buildä»¥é™ã®è¨­å®šã¯ã€ä¸‹è¨˜ã®é€šã‚Šé¸æŠã—ã¾ã™ã€‚

```shell-session
$ Vue build 
â¯ Runtime + Compiler: recommended for most users 
Runtime-only: about 6KB lighter min+gzip, but templates (or any Vue-specific HTML) are ONLY allowed in .vue files - render functions are required elsewhere 
$ Install vue-router? (Y/n) Y
$ Use ESLint to lint your code? (Y/n) n
$ Set up unit tests (Y/n) n
$ Setup e2e tests with Nightwatch? (Y/n) n
```

æœ€å¾Œã«ã€æ¬¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¯å®Œäº†ã§ã™ã€‚

```shell-session
   vue-cli Â· Generated "vue-wp-project".

   To get started:

     cd vue-wp-project
     npm install
     npm run dev

   Documentation can be found at https://vuejs-templates.github.io/webpack
```

## ç¾çŠ¶ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒãƒƒãƒ—
ä»¥é™ã€vue-wp-projectç›´ä¸‹ã‚’`./`ã¨è¨˜è¼‰ã—ã¾ã™ã€‚

```shell-session
vue-wp-project
.
â”œâ”€ build
â”‚  â””â”€ *.js
â”œâ”€ config
â”‚  â””â”€ *.js
â”œâ”€ src
â”‚  â”œâ”€ assets
â”‚  â”‚   â””â”€ logo.png
â”‚  â”œâ”€ components
â”‚  â”‚   â””â”€ HelloWorld.vue
â”‚  â”œâ”€ router
â”‚  â”‚   â””â”€ index.js
â”‚  â”œâ”€ App.vue
â”‚  â””â”€ main.js
â”œâ”€ static
â”œâ”€ .*
â”œâ”€ index.html
â”œâ”€ package.json
â””â”€ README.md
```

## Wordpressæœ¬ä½“ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
https://ja.wordpress.org/download/  ã‹ã‚‰ã€Wordpressæœ¬ä½“ã®zipã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

ç¶šã‘ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå´ã«æ–°ãŸã«ã€wwwãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€`www`ä»¥ä¸‹ã«`html`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã€ãã®ä¸­ã«zipã‚’è§£å‡ã—ãŸä¸­ã«ã‚ã‚‹`wp-content`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

ã‚³ã‚³ã¾ã§çµ‚ãˆã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªæ§‹æˆã«ãªã‚Šã¾ã™ã€‚

```shell-session
vue-wp-project
.
~ç•¥~
â””â”€ www/html/wp-content
```

## Wordpress Themeã®ä½œæˆ
`./www/html/wp-content/themes/`ã‚’é–‹ãã€æ–°ãŸã«`sample`ã¨ã„ã†åå‰ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ã€`header.php`ã€`footer.php`ã€`index.php`ã€`functions.php`ã€`style.css`ã®ï¼•ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã€ãã‚Œãã‚Œä¸‹è¨˜ã®é€šã‚Šæ›¸ãæ›ãˆã¦ã„ãã¾ã™ã€‚

<Pre label="style.css">
```css
/*
Theme Name: SAMPLE
Theme URI: 
Description: 
Version: 0.1
*/
```
</Pre>

<Pre label="header.php">
```php
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title><?php echo the_title()?></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="<?php echo get_template_directory_uri()?>/assets/css/app.css" media="screen">
    <?php wp_head() ?>
  </head>
  <body>
```
</Pre>

<Pre label="footer.php">
```php
    <script src="<?php bloginfo('template_url')?>/assets/js/manifest.js"></script>
    <script src="<?php bloginfo('template_url')?>/assets/js/vendor.js"></script>
    <script src="<?php bloginfo('template_url')?>/assets/js/app.js"></script>
    <?php wp_footer()?>
  </body>
</html>
```
</Pre>

<Pre label="index.php">
```php
<?php get_template_part('header')?>
  <div id="app"></div>
<?php get_template_part('footer')?>
```
</Pre>

functions.phpã«é–¢ã—ã¦ã¯ã€ç¾çŠ¶ã¯ç©ºã®ã¾ã¾é€²ã‚ã¾ã™ã€‚

## webpackã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãæ›ãˆ
`./config/index.js`å†…ã€55è¡Œç›®è¾ºã‚Šã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹buildã®Pathséƒ¨åˆ†ã‚’æ¬¡ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚

```js
// Paths
assetsRoot: path.resolve(__dirname, '../www/html/wp-content/themes/sample'),
assetsSubDirectory: 'assets',
assetsPublicPath: '/',
```

ã•ã‚‰ã«ã€`./build/webpack.prod.conf.js`å†…ã€outputã«æŒ‡å®šã•ã‚Œã¦ã„ã‚‹`.[chunkhash]`
ã¨ã€ExtractTextPluginéƒ¨åˆ†ã®`.[contenthash]`ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```js
  output: {
    path: config.build.assetsRoot,
    filename: utils.assetsPath('js/[name].js'),
    chunkFilename: utils.assetsPath('js/[id].js')
  },



    new ExtractTextPlugin({
      filename: utils.assetsPath('css/[name].css'),
```


ã“ã“ã¾ã§çµ‚ãˆãŸã‚‰ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```shell-session
$ npm install axios -D && npm install vuex -s
$ npm install
$ npm run build
```

## Wordpressã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«`docker-compose.yml`ã‚’ä½œæˆã—ã¾ã™ã€‚

<Pre label="docker-compose.yml">
```yml
version: "2"
services:
  wordpress:
    image: wordpress:4.9-php5.6
    ports:
      - 6001:80
    volumes:
      - ./www/html/wp-content:/var/www/html/wp-content
    links:
      - mysql
    environment:
      WORDPRESS_DB_HOST: "mysql:3306"
      WORDPRESS_DB_NAME: vue-wp-project
      WORDPRESS_DB_USER: vwp_user
      WORDPRESS_DB_PASSWORD: testtest
  mysql:
    image: mysql:5.7
    ports:
      - 3306:3306
    volumes:
      - db-data:/var/lib/mysql
    working_dir: /var/sql
    environment:
      MYSQL_RANDOM_ROOT_PASSWORD: "yes"
      MYSQL_DATABASE: vue-wp-project
      MYSQL_USER: vwp_user
      MYSQL_PASSWORD: testtest
volumes:
    db-data:
      driver: local
```
</Pre>

ç¶šã‘ã¦ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```shell-session
$ docker-machine create --driver virtualbox vue-wp-project
$ eval $(docker-machine env vue-wp-project)
$ docker-compose up -d
```

ã“ã“ã¾ã§æ¥ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ http://192.168.99.100:6001 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€æ¬¡ã®ç”»é¢ãŒå‡ºã‚‹ã¯ãšã§ã™ã€‚

![wordpress_setup_.png](/media/2017/12/wordpress_setup_.png)

å¿…è¦ãªé …ç›®ã‚’å…¥åŠ›ã—ã€Installå®Œäº†å¾Œã€Dashboardã®Appearance > Themes
ã«å…ˆã»ã©ä½œæˆã—ãŸãƒ†ãƒ¼ãƒã®ã€ŒSAMPLEã€ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€ã€ŒActivateã€ã—ã¾ã™ã€‚ï¼ˆé …ç›®å†…å®¹ã«ç‰¹ã«æŒ‡å®šã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰

![select_themes.png](/media/2017/12/select_themes.png)


å†åº¦ http://192.168.99.100:6001 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ã‚¹ã‚¯ã‚·ãƒ§ã®ã‚ˆã†ãªç”»é¢ã«ãªã£ã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![hello_world.png](/media/2017/12/hello_world.png)


ã“ã“ã¾ã§ã§ã€ç’°å¢ƒæ§‹ç¯‰ã¯çµ‚äº†ã§ã™ã€‚

storeã®ä½œæˆ
ã“ã“ã‹ã‚‰ã‚„ã£ã¨Vue.jsã«ç§»ã‚Šã¾ã™ã€‚ã¾ãšã¯ã€è¨˜äº‹å–å¾—ç”¨ã®å‡¦ç†ã®ä½œæˆã§ã™ã€‚

`./src`ä»¥ä¸‹ã«storeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ã€`index.js`ã‚’ä½œæˆã€
ã•ã‚‰ã«`store`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«`modules`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ã€`posts.js`ã‚’ä½œæˆã—ã¾ã™ã€‚

å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã¯ãã‚Œãã‚Œä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

<Pre label="./src/store/index.js">
```js
import Vue from 'vue';
import Vuex from 'vuex';

import modulePosts from './modules/posts';

Vue.use(Vuex);

export default new Vuex.Store({
  modules: {
    posts: modulePosts,
  },
});
```
</Pre>

`posts.js`å´ã§ã¯ã€actionsã«fetchPostsã¨ã„ã†å‡¦ç†ã‚’æ›¸ãã€dispatchæ™‚ã«WP REST APIã®`/posts`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§è¨˜äº‹ã‚’å–å¾—ã—ã¦ã€stateã®postsã¸ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

<Pre label="./src/store/modules/posts.js">
```js
import axios from 'axios'

const api = axios.create({
  baseURL: 'http://192.168.99.100:6001/wp-json/wp/v2'
});

const stateObject = {
  posts: []
};

const getters = {
  posts(state) {
    return state.posts
  }
};

const mutations = {
  SAVE_POSTS(state, posts) {
    state.posts = posts
  }
};

const actions = {
  'fetchPosts': ({ state, commit }, id) => {
    const _id = id ? `/${id}` : '';

    return api.get(`/posts${_id}`).then(res => {
      commit('SAVE_POSTS', res.data);
    });
  }
};

export default {
  namespaced: true,
  state: stateObject,
  getters,
  mutations,
  actions,
};
```
</Pre>

## main.jsã«storeã‚’è¿½è¨˜
`./src/main.js`ã«storeã‚’è¿½è¨˜ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

<Pre label="main.js">
```js
// The Vue build version to load with the `import` command
// (runtime-only or standalone) has been set in webpack.base.conf with an alias.
import Vue from 'vue'
import App from './App'
import router from './router'
import store from './store'

Vue.config.productionTip = false

new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app')
```
</Pre>

## è¨˜äº‹è¡¨ç¤ºç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
è¨˜äº‹ä¸€è¦§ã€è¨˜äº‹è©³ç´°ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã€`./src/components`ä»¥ä¸‹ã«ä½œæˆã—ã¾ã™ã€‚

<Pre label="list.vue">
```js
<template>
  <div>
    <h1>è¨˜äº‹ä¸€è¦§</h1>
    <div v-for="post in posts" :key="post.id">
      <router-link :to="`/article/${ post.id }`">{{ post.slug }}</router-link>
    </div>
  </div>
</template>

<script>
import { mapGetters } from 'vuex';

export default {
  name: 'list',
  data () {
    return {
    }
  },
  computed: {
    ...mapGetters({
      'posts': 'posts/posts'
    })
  },
  methods: {
  }
}
</script>
```
</Pre>

<Pre label="article.vue">
```js
<template>
  <article>
    <h2>{{ posts.title.rendered }}</h2>
    <div v-html="posts.content.rendered"></div>
  </article>
</template>

<script>
import { mapGetters } from 'vuex';

export default {
  name: 'article',
  data () {
    return {
    }
  },
  computed: {
    ...mapGetters({
      'posts': 'posts/posts'
    })
  },
}
</script>
```
</Pre>

## vue-routerã®èª¿æ•´
`./src/router/index.js`ã®ãƒ«ãƒ¼ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã®é€šã‚Šèª¿æ•´ã—ã¾ã™ã€‚
å„è¨˜äº‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ‡ã‚Šæ›¿ãˆå‰ã«ã¯fetchPostsã‚’dispatchã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

<Pre label="./src/router/index.js">
```js
import Vue from 'vue'
import Router from 'vue-router'
import Store from '@/store'

import List from '@/components/list'
import Article from '@/components/article'

Vue.use(Router)

export default new Router({
  mode: 'history',
  base: '/',
  routes: [
    {
      path: '/',
      name: 'list',
      component: List,
      beforeEnter: (to, from, next) => {
        Store.dispatch('posts/fetchPosts')
          .then(() => { next() })
      }
    },
    {
      path: '/article/:id',
      name: 'article',
      component: Article,
      beforeEnter: (to, from, next) => {
        const id = to.params['id'];
        Store.dispatch('posts/fetchPosts', id)
          .then(() => { next() })
      }
    }
  ]
})
```
</Pre>

## ç¢ºèªã€œWordpressã¸å±•é–‹
ã“ã“ã¾ã§çµ‚ãˆãŸã‚‰ã€`$ npm run dev`ã‚’å®Ÿè¡Œã—ã€http://localhost:8080 ã‚’ç¢ºèªã—ã¾ã™ã€‚
ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒå‡ºã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![wp_list.png](/media/2017/12/wp_list.png)

hello-worldã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚¹ã‚¯ã‚·ãƒ§ã®ã‚ˆã†ã«è¨˜äº‹æœ¬æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ã€‚

![wp_article.png](/media/2017/12/wp_article.png)


æœ€å¾Œã«ã€`$ npm run build`ã§ãƒ“ãƒ«ãƒ‰ã—ã€Themeå´ã«å±•é–‹ã•ã‚ŒãŸã‚‰ http://192.168.99.100:6001/
 ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Wordpressä¸Šã§ã‚‚å‹•ä½œã—ã¦ã„ã‚‹äº‹ãŒç¢ºèªã§ãã‚Œã°ã€æˆåŠŸã§ã™ã€‚

![wp_build.png](/media/2017/12/wp_build.png)


## éå…¬é–‹è¨˜äº‹ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ
Dashboardã‚’é–‹ãã€ã€ŒSettings > Permalinksã€ã§ã€Common Settingsã‚’ã€ŒCustom Structureã€ã«å¤‰æ›´ã—ã€è¨­å®šã‚’`article/%post_id%/`ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚

![settings.png](/media/2017/12/settings.png)


ã•ã‚‰ã«ã€Postsã‹ã‚‰ã€ŒHelloWorldã€ã®è¨˜äº‹ã‚’ä¸€æ—¦ã€ã€ŒPrivateã€ã«å¤‰æ›´ã—ã¦ã¿ã¾ã™ã€‚

![private.png](/media/2017/12/private.png)


ã“ã®çŠ¶æ…‹ã§Hello worldã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã¨ã€æ¬¡ã®ã‚¹ã‚¯ã‚·ãƒ§ã®ã‚ˆã†ã«ã€403ï¼ˆé–²è¦§ç¦æ­¢ï¼‰ãŒè¿”ã£ã¦ãã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![403.png](/media/2017/12/403.png)


ã“ã‚Œã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚‹ã‹èªè¨¼ã•ã‚Œã‚‹ãŸã‚ã§ã™ãŒã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¦ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ç†ç”±ã¨ã—ã¦ã¯ã€Wordpressã§ã¯CSRFå¯¾ç­–ã®ãŸã‚ã€"nonce"ã¨ã„ã†ä¸€æ™‚çš„ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’éƒ½åº¦ç”Ÿæˆã—ã¦ãŠã‚Šã€ç¾çŠ¶nonceãŒã€axiosã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ã«å«ã¾ã‚Œã¦ã„ãªã„ç‚ºã§ã™ã€‚

jså´ã§å‹•çš„ã«ç”Ÿæˆã•ã‚ŒãŸnonceã‚’å—ã‘å–ã‚‹ã«ã¯ã€ç’°å¢ƒæ§‹ç¯‰æ™‚ã®æ‰‹é †ã§ä½œæˆã—ã¦ã„ãŸfunctions.phpã«ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚

ã“ã‚Œã§ã€wp_create_nonceã§ç”Ÿæˆã—ãŸWP REST APIç”¨ã®nonceã‚’ã€app.jsãŒå–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

<Pre label="functions.php">
```php
<?php
wp_enqueue_script( 'app', get_template_directory_uri() . '/assets/js/app.js', array(), false, true );
wp_localize_script( 'app', 'WP_API_Settings', array(
    'root' => esc_url_raw( rest_url() ),
    'nonce' => wp_create_nonce( 'wp_rest' )
) );
```
</Pre>

ã“ã®æ®µéšã§ã€footer.phpã«æ›¸ã„ã¦ã„ãŸapp.jsã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãŠãã¾ã™ã€‚

<Pre label="footer.php">
```php
    <script src="<?php bloginfo('template_url')?>/assets/js/manifest.js"></script>
    <script src="<?php bloginfo('template_url')?>/assets/js/vendor.js"></script>
    <!--script src="<?php bloginfo('template_url')?>/assets/js/app.js"></script-->
    <?php wp_footer()?>
  </body>
</html>
```
</Pre>

æœ€å¾Œã«ã€`./src/store/modules/posts.js` ã®ã€axios.createã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚’æ¬¡ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã‚Œã°å®Œäº†ã§ã™ã€‚

<Pre label="./src/store/modules/posts.js">
```js
const api = axios.create({
  baseURL: 'http://192.168.99.100:6001/wp-json/wp/v2',
  headers: { 'X-WP-Nonce': window.WP_API_Settings.nonce }
});
```
</Pre>

ã“ã“ã¾ã§çµ‚ãˆãŸã‚‰ã€å†åº¦npm run buildã‚’è¡Œã„ã€http://192.168.99.100:6001/article/1/
 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€éå…¬é–‹ã®è¨˜äº‹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

![nonce.jpg](/media/2017/12/nonce.jpg)


## æœ€å¾Œã«
ã“ã“ã¾ã§èª­ã‚“ã§é ‚ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼
ç§è‡ªèº«ã€Vue.jsã«ã¤ã„ã¦æ­£ã—ãç†è§£ã§ãã¦ã„ãªã„ç‚¹ãŒã¾ã ã¾ã ã‚ã‚Šã€å­¦ç¿’ã›ã­ã°ã¨ã„ã£ãŸæ„Ÿã˜ã§ã™ãŒã€ã‚‚ã—ã“ã®è¨˜äº‹ãŒä½•ã‹ã®è¶³ãŒã‹ã‚Šã«ã§ã‚‚ãªã‚Œã°å¹¸ã„ã§ã™ã€‚